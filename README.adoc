image::https://oci-resourcemanager-plugin.plugins.oci.oraclecloud.com/latest/deploy-to-oracle-cloud.svg[Deploy on Oracle Cloud, link="https://cloud.oracle.com/resourcemanager/stacks/create?zipUrl=https://github.com/oracle-devrel/terraform-oci-ocloud-landing-zone/archive/refs/heads/main.zip"]

== The OCloud Framework: Landing Zone

image:https://img.shields.io/badge/license-UPL-green[link="LICENSE"]
image:https://sonarcloud.io/api/project_badges/quality_gate?project=oracle-devrel_terraform-oci-ocloud-landing-zone[Quality gate, link="https://sonarcloud.io/dashboard?id=oracle-devrel_terraform-oci-ocloud-landing-zone"]

=== Introduction
The service delivery framework "ocloud" helps operators to set up a hosting environment for enterprise applications in Oracle Cloud Infrastructure (OCI). While launching a new resource in OCI is a matter of pressing a button, preparing a tenancy to extend or replace on-prem infrastructure can be challenging. Provisioning private cloud involves numberous services and requires a deep understanding of various configuration options build into Oracle's automated infrastructure platform.

[#img-architecture] 
.Base Architecture 
image::doc/image/base_architecture.png[Base Architecture]

This framework helps operators to automate the provisioning processes for an initial set of resources that turn a fresh OCI tenancy into a private cloud. It includes a typical network design for three tier applications, implements a security baseline and ensures consistent names for accross infrastructure components. The setup reflects the separation of duties, typically found in an ITIL oriented organization and builds a foundation for a multi-tenant service operation. 

=== Getting Started
The first layer of code addresses the needs of system adminstrators. It is written in HCL and captures the parameters that customize the provisioning processes for OCI core resources. 

[#img-structure] 
.Code Structure 
image::doc/image/code_structure.png[Code Structure]

The default repository separates four templates:

* https://gitlab.com/tboettjer/ocloud-platform/-/blob/master/operation.tf[Operations] prepares a working environment priviledged operators with an "ops" compartment that contains base roles like the cloud "super admin".
* https://gitlab.com/tboettjer/ocloud-platform/-/blob/master/network.tf[Network] provisions an initial network segment and creates a "presentation" domain for internet facing portals beside the "netops" compartment and role.
* https://gitlab.com/tboettjer/ocloud-platform/-/blob/master/database.tf[Database] defines the infrastructure for database hosting with access via port 1521-1522 in addition to the "db" compartment and admin role.
* https://gitlab.com/tboettjer/ocloud-platform/-/blob/master/application.tf[Application] creates an application management domain, the an app compartment, the sysops role and deploys an operator for remote scripts.

The ops and the net deployment templates are obligatory, the db and the app templates are optional. The bastion service connects to an operator in the application domain and allows to enter all domains via SSH.

==== Components
Templates refer to terraform modules, rather than addressing resource blocks directly. Platform components combine multiple resources logically into Terraform modules. These modules contain best practices collected throughout numberous projects and remain subject to change. Initially we provide the following modules:

* https://gitlab.com/tboettjer/ocloud-platform/-/tree/master/module/admin_section[Administrator Section] is the compartment block combined with groups an policies that define a working environment for cloud and security operators
* https://gitlab.com/tboettjer/ocloud-platform/-/tree/master/module/network_segment[Network Segment] defines the compart and role for network administrators together with a Virtual Cloud Network (VCN) incl. Dynamic Routing Gateway and gateways for NAT, Intenrnet and Oracle Services
* https://gitlab.com/tboettjer/ocloud-platform/-/tree/master/module/network_domain[Network Domain] the necessary subnets with portfilters and routing rules to host the application tiers
* https://gitlab.com/tboettjer/ocloud-platform/-/tree/master/module/application_host[Application Host] launches a compute node and executes the respective configuration scripts are executed

==== Resource Interfaces

Modules deploy a variety of different resources, like infrastructure components, predefined cloud services, applications or third party software products. Usually we employ the terraform service provider to provision resources, however, comand line scripts, API or SDK are additional options.

[cols="1,1,1,1,1",options="header"]
|===
|          | Admin Section | Network Segment | Network Domain | Application Host
| Core     | Compartment   | VCN,            | Subnet         | Instance
| Gateways |               | DRG, NAT, IGW   |                | ...
| Roles    | Group, Policy |                 |                | ...
| SSH      | Bastion       |                 |                | Session
|=== 


==== Prerequisites
Code is written in HashiCorp Configuration Language (HCL), includes data stored in JSON format and cloud init scripts. It is executed with link:https://www.terraform.io[Terraform]. Resource Manager is an Oracle Cloud Infrastructure service that helps to install, configure, and manage Terraform code to support a fast adoption of the "infrastructure-as-code" model.

* link:https://www.oracle.com/cloud/free/[Oracle Cloud Infrastructure (OCI) Account] 
* link:https://docs.oracle.com/en-us/iaas/Content/ResourceManager/Concepts/resourcemanager.htm[Oracle Resource Manager]
* link:https://registry.terraform.io/providers/hashicorp/oci/latest[OCI Service Provider]
* link:https://registry.terraform.io/providers/hashicorp/time/latest[Time Service Provider]

=== Notes/Issues
* Destroying compartments should be an exception and can take a long time. Best practice is destroying all other resources first, before destroying the compartments in a separate run. In the default setup, the "enable_delete" flag prevent unintensional destroy of compartments 
* Using Terraform 1.0 produces a warning about missing provider definitions in the module directories, which can be ignored
* Under specific circumstances, resource dependencies can cause deployment errors. In that case, terraform apply or destroy commands are required to run repeatedly to reach the desired state

=== URLs
This repository is intended to be used with the Oracle Resource Manager. Using the "Deploy to Oracle Cloud" Button requires users to sign in.
* Sign In: https://www.oracle.com/cloud/sign-in.html

=== Contributing
This project is open source.  Please submit your contributions by forking this repository and submitting a pull request!  Oracle appreciates any contributions that are made by the open source community.

=== License
Copyright (c) 2021 Oracle and/or its affiliates.

Licensed under the Universal Permissive License (UPL), Version 1.0.

See link:LICENSE[LICENSE] for more details.